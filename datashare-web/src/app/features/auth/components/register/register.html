<mat-card class="login-card">
  <mat-card-header class="title-section">
    <mat-card-title>Créer un compte</mat-card-title>
  </mat-card-header>

  @if (message() && !isAuthenticated()) {
  <mat-label class="error-message">{{ message() }}</mat-label>
  }

  <!-- Formulaire -->
  <mat-card-content class="form-section">
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      <!-- EMAIL -->
      <mat-label>Email</mat-label>
      @if (registerForm.get('email')?.hasError('required')) {
      <mat-error>Email requis</mat-error>
      } @if (email?.touched && email?.errors?.['email']) {
      <mat-error>Email invalide</mat-error>
      }
      <mat-form-field appearance="outline" class="full-width">
        <input
          matInput
          type="email"
          formControlName="email"
          placeholder="Saisissez votre email..."
          required
        />
      </mat-form-field>

      <!-- PASSWORD -->
      <mat-label>Mot de passe</mat-label>
      @if (registerForm.get('password')?.hasError('required')) {
      <mat-error>Mot de passe requis</mat-error>
      } @if (password?.touched && password?.errors?.['minlength']) {
      <mat-error>Le mot de passe doit avoir au moins 8 caractères</mat-error>
      }
      <mat-form-field appearance="outline" class="full-width">
        <input
          matInput
          [type]="showPassword ? 'text' : 'password'"
          formControlName="password"
          placeholder="Saisissez votre mot de passe"
          required
        />
        <button
          mat-icon-button
          matSuffix
          (click)="showPassword = !showPassword; showConfirmPassword = !showConfirmPassword"
          type="button"
        >
          <mat-icon
            >{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon
          >
        </button>
      </mat-form-field>

      <!-- CONFIRM PASSWORD -->
      <mat-label>Vérification du mot de passe</mat-label>
      @if (registerForm.get('confirmPassword')?.hasError('required')) {
      <mat-error>Confirmation requise</mat-error>
      } @if (registerForm.errors?.['passwordMismatch'] &&
      confirmPassword?.touched) {
      <mat-error>Les mots de passe ne correspondent pas</mat-error>
      }
      <mat-form-field appearance="outline" class="full-width">
        <input
          matInput
          [type]="showConfirmPassword ? 'text' : 'password'"
          formControlName="confirmPassword"
          placeholder="Saisissez le à nouveau"
          required
        />
        <button
          mat-icon-button
          matSuffix
          (click)="showPassword = !showPassword; showConfirmPassword = !showConfirmPassword"
          type="button"
        >
          <mat-icon
            >{{ showConfirmPassword ? 'visibility_off' : 'visibility'
            }}</mat-icon
          >
        </button>
      </mat-form-field>

      <!-- BOUTONS VERTICAUX -->
      <div class="buttons-vertical">
        <a mat-button class="btn-secondary" (click)="login()"
          >J'ai déjà un compte</a
        >
        <button
          mat-raised-button
          class="btn-primary"
          type="submit"
          [disabled]="registerForm.invalid"
        >
          @if (loading) { Création du compte... } @else { Créer compte }
        </button>
      </div>
    </form>
  </mat-card-content>
</mat-card>
